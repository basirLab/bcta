<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>BCTA í‰ê°€ ê²°ê³¼</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    h1 { text-align: center; }
    .score-box { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 8px; }
    .score-box h2 { margin: 0; font-size: 18px; }
    .score { font-weight: bold; font-size: 16px; }
    .feedback { margin-top: 5px; color: #555; }
    button { margin: 20px 10px; padding: 10px 20px; font-size: 16px; }
  </style>
</head>
<body>
  <h1>ğŸ“Š ë¹„íŒì  ì‚¬ê³  í‰ê°€ ê²°ê³¼</h1>
  <div id="resultsContainer"></div>

  <div style="text-align:center;">
    <button onclick="location.href='index.html'">ë©”ì¸ìœ¼ë¡œ</button>
    <button onclick="location.href='questions.html'">ë‹¤ì‹œ í•˜ê¸°</button>
  </div>

  <script>
    const raw = JSON.parse(localStorage.getItem("ct-answers") || "{}");
    const results = Object.values(raw).filter(item => item.evaluation);

    const CT_CODES = ["CT1", "CT2", "CT3", "CT4", "CT5", "CT6"];
    const CT_LABELS = {
      CT1: "í•´ì„ë ¥", CT2: "ë¶„ì„ë ¥", CT3: "í‰ê°€ë ¥",
      CT4: "ì¶”ë¡ ë ¥", CT5: "ì„¤ëª…ë ¥", CT6: "ìê¸°ì¡°ì ˆë ¥"
    };

    const total = { CT1: [], CT2: [], CT3: [], CT4: [], CT5: [], CT6: [] };
    const feedbacks = { CT1: [], CT2: [], CT3: [], CT4: [], CT5: [], CT6: [] };

    results.forEach(item => {
      CT_CODES.forEach(code => {
        const score = item.evaluation[code]?.score || 0;
        const fb = item.evaluation[code]?.feedback || "í”¼ë“œë°± ì—†ìŒ";
        total[code].push(score);
        feedbacks[code].push(fb);
      });
    });

    const container = document.getElementById("resultsContainer");

    CT_CODES.forEach(code => {
      const scores = total[code];
      const avg = scores.reduce((a, b) => a + b, 0) / (scores.length || 1);
      const feedback = feedbacks[code][feedbacks[code].length - 1];

      const box = document.createElement("div");
      box.className = "score-box";
      box.innerHTML = `
        <h2>${CT_LABELS[code]} (${code})</h2>
        <div class="score">í‰ê·  ì ìˆ˜: ${avg.toFixed(1)} / 4</div>
        <div class="feedback">ğŸ“ ${feedback}</div>
      `;
      container.appendChild(box);
    });
  </script>
</body>
</html>
